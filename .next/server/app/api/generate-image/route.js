"use strict";(()=>{var e={};e.id=495,e.ids=[495],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},975:(e,o,t)=>{t.r(o),t.d(o,{originalPathname:()=>d,patchFetch:()=>f,requestAsyncStorage:()=>c,routeModule:()=>m,serverHooks:()=>v,staticGenerationAsyncStorage:()=>u});var r={};t.r(r),t.d(r,{POST:()=>p});var a=t(226),s=t(2113),n=t(804),l=t(878),i=t(2607);async function g(e){if(console.log("[v0] Converting image format:",e.type,"size:",e.size),["image/png","image/jpeg","image/webp"].includes(e.type)){let o=Buffer.from(await e.arrayBuffer());return console.log("[v0] Image already supported, buffer size:",o.length),{buffer:o,mimeType:e.type}}console.log("[v0] Converting unsupported format",e.type,"to image/jpeg");let o=Buffer.from(await e.arrayBuffer());return console.log("[v0] Converted buffer size:",o.length),{buffer:o,mimeType:"image/jpeg"}}async function p(e){try{console.log("[v0] === Starting generate-image POST request ===");let o=await e.formData();console.log("[v0] FormData received, keys:",Array.from(o.keys()));let t=o.get("image1"),r=o.get("image2"),a=o.get("prompt");if(console.log("[v0] Extracted data:"),console.log("[v0] - image1:",t?.name,t?.type,t?.size),console.log("[v0] - image2:",r?.name,r?.type,r?.size),console.log("[v0] - prompt length:",a?.length),console.log("[v0] - prompt preview:",a?.substring(0,100)+"..."),!t||!r||!a)return console.log("[v0] Missing required fields"),i.NextResponse.json({error:"Missing required fields"},{status:400});console.log("[v0] Original image types:",t.type,r.type),console.log("[v0] Converting image1...");let s=await g(t);console.log("[v0] Image1 converted successfully"),console.log("[v0] Converting image2...");let n=await g(r);console.log("[v0] Image2 converted successfully"),console.log("[v0] Converted image types:",s.mimeType,n.mimeType),console.log("[v0] Preparing to call generateText with AI Gateway...");let p=await (0,l._4)({model:"google/gemini-2.5-flash-image-preview",providerOptions:{google:{responseModalities:["TEXT","IMAGE"]}},messages:[{role:"user",content:[{type:"text",text:a},{type:"image",image:s.buffer},{type:"image",image:n.buffer}]}]});console.log("[v0] generateText completed"),console.log("[v0] Result keys:",Object.keys(p)),console.log("[v0] Result.files:",p.files?.length||0,"files"),console.log("[v0] Result.text length:",p.text?.length||0),console.log("[v0] Result.usage:",p.usage);let m=p.files?.filter(e=>e.mediaType?.startsWith("image/"));if(console.log("[v0] Image files found:",m?.length||0),!m||0===m.length)return console.log("[v0] No image files generated"),i.NextResponse.json({error:"No image was generated"},{status:500});let c=m[0];console.log("[v0] Generated image mediaType:",c.mediaType),console.log("[v0] Generated image has base64:",!!c.base64);let u=`data:${c.mediaType};base64,${c.base64}`;return console.log("[v0] Base64 image created, length:",u.length),console.log("[v0] Successfully generated image"),i.NextResponse.json({imageUrl:u,text:p.text,usage:p.usage})}catch(e){return console.error("[v0] Error in generate-image POST handler:",e),console.error("[v0] Error type:",typeof e),console.error("[v0] Error message:",e instanceof Error?e.message:String(e)),console.error("[v0] Error stack:",e instanceof Error?e.stack:"No stack"),i.NextResponse.json({error:"Failed to generate image"},{status:500})}}console.log("[v0] AI Gateway API key available:",!!process.env.AI_GATEWAY_API_KEY);let m=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/generate-image/route",pathname:"/api/generate-image",filename:"route",bundlePath:"app/api/generate-image/route"},resolvedPagePath:"/Users/macbookpro/posbok_storefront/app/api/generate-image/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:u,serverHooks:v}=m,d="/api/generate-image/route";function f(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:u})}}};var o=require("../../../webpack-runtime.js");o.C(e);var t=e=>o(o.s=e),r=o.X(0,[455,689],()=>t(975));module.exports=r})();